---
import '../styles/global.css';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';

export interface Props {
  title: string;
  description?: string;
  pageType?: string;
  breadcrumbs?: Array<{ name: string; url: string }>;
}

const { 
  title, 
  description = "Intellica — Empowering enterprises to generate sustainable value from data through modern data platforms, analytics solutions, and production-grade AI systems.",
  pageType = "website",
  breadcrumbs = []
} = Astro.props;

const siteUrl = "https://intellica-tech.github.io";
const canonicalUrl = new URL(Astro.url.pathname, siteUrl).href;
const ogImage = `${siteUrl}/assets/img/intellica-og.png`;

// Organization JSON-LD (shared across all pages)
const organizationSchema = {
  "@context": "https://schema.org",
  "@type": "Organization",
  "@id": `${siteUrl}/#organization`,
  "name": "Intellica",
  "url": siteUrl,
  "logo": `${siteUrl}/assets/img/intellica-logo.png`,
  "description": "Intellica is a global Data & AI company empowering enterprises with modern data platforms, analytics solutions, and production-grade AI systems since 2006.",
  "foundingDate": "2006",
  "numberOfEmployees": { "@type": "QuantitativeValue", "minValue": 450 },
  "areaServed": ["Turkey", "United Arab Emirates", "Saudi Arabia", "Pakistan", "United Kingdom", "United States", "Albania"],
  "knowsAbout": ["Data Warehousing", "Business Intelligence", "Artificial Intelligence", "Machine Learning", "Data Governance", "Data Analytics", "Generative AI", "Agentic AI"],
  "sameAs": [
    "https://www.linkedin.com/company/intellica",
    "https://www.intellica.net"
  ],
  "address": {
    "@type": "PostalAddress",
    "streetAddress": "Atatürk Mah. Turgut Özal Blv. Gardenya 1 Plaza, Floor 1",
    "addressLocality": "Ataşehir",
    "addressRegion": "Istanbul",
    "addressCountry": "TR"
  },
  "contactPoint": {
    "@type": "ContactPoint",
    "telephone": "+90-216-688-45-46",
    "contactType": "sales",
    "email": "info@intellica.net",
    "availableLanguage": ["English", "Turkish"]
  }
};

// BreadcrumbList JSON-LD
const breadcrumbSchema = breadcrumbs.length > 0 ? {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    { "@type": "ListItem", "position": 1, "name": "Home", "item": `${siteUrl}/` },
    ...breadcrumbs.map((crumb, i) => ({
      "@type": "ListItem",
      "position": i + 2,
      "name": crumb.name,
      "item": crumb.url
    }))
  ]
} : null;
---
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1" />
  <meta name="author" content="Intellica" />
  <meta name="generator" content={Astro.generator} />
  <link rel="canonical" href={canonicalUrl} />

  <!-- Preconnect hints -->
  <link rel="preconnect" href="https://www.googletagmanager.com" />
  <link rel="dns-prefetch" href="https://www.linkedin.com" />

  <title>{title}</title>
  <meta name="description" content={description} />

  <!-- Favicons -->
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <link rel="icon" href="/favicon.ico" />

  <!-- Open Graph -->
  <meta property="og:site_name" content="Intellica" />
  <meta property="og:title" content={title} />
  <meta property="og:description" content={description} />
  <meta property="og:type" content={pageType} />
  <meta property="og:url" content={canonicalUrl} />
  <meta property="og:locale" content="en_US" />
  <meta property="og:image" content={ogImage} />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content={title} />
  <meta name="twitter:description" content={description} />
  <meta name="twitter:image" content={ogImage} />

  <meta name="theme-color" content="#030B16" />

  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-CXE19ZY84F"></script>
  <script is:inline>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-CXE19ZY84F');
  </script>

  <!-- Structured Data: Organization -->
  <script type="application/ld+json" set:html={JSON.stringify(organizationSchema)} />

  <!-- Structured Data: BreadcrumbList -->
  {breadcrumbSchema && (
    <script type="application/ld+json" set:html={JSON.stringify(breadcrumbSchema)} />
  )}

  <!-- Page-specific structured data slot -->
  <slot name="head" />
</head>
<body>
  <Header />
  <main>
    <slot />
  </main>
  <Footer />
  <script>
    // Scroll animations
    const observer = new IntersectionObserver((entries) => {
      entries.forEach((entry, i) => {
        if (entry.isIntersecting) {
          setTimeout(() => {
            entry.target.classList.add('visible');
          }, i * 80);
          observer.unobserve(entry.target);
        }
      });
    }, { threshold: 0.1, rootMargin: '0px 0px -60px 0px' });

    document.querySelectorAll('.anim-fade-up').forEach(el => observer.observe(el));

    // Counter animation
    function animateCounter(el: HTMLElement) {
      const target = parseInt(el.dataset.target || '0');
      const duration = 1800;
      const start = performance.now();
      const update = (now: number) => {
        const elapsed = now - start;
        const progress = Math.min(elapsed / duration, 1);
        const ease = 1 - Math.pow(1 - progress, 3);
        el.textContent = String(Math.round(ease * target));
        if (progress < 1) requestAnimationFrame(update);
      };
      requestAnimationFrame(update);
    }

    const counterObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          animateCounter(entry.target as HTMLElement);
          counterObserver.unobserve(entry.target);
        }
      });
    }, { threshold: 0.5 });

    document.querySelectorAll('.counter').forEach(el => counterObserver.observe(el));

    // Mobile nav toggle
    const mobileToggle = document.getElementById('mobile-toggle');
    const mobileMenu = document.getElementById('mobile-menu');
    if (mobileToggle && mobileMenu) {
      mobileToggle.addEventListener('click', () => {
        mobileMenu.classList.toggle('open');
        mobileToggle.classList.toggle('open');
      });
    }

    // Dropdown menus
    document.querySelectorAll('[data-dropdown]').forEach(dd => {
      const btn = dd.querySelector('button');
      const menu = dd.querySelector('.dd-menu');
      if (btn && menu) {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          menu.classList.toggle('open');
          btn.setAttribute('aria-expanded', String(menu.classList.contains('open')));
        });
      }
    });
    document.addEventListener('click', () => {
      document.querySelectorAll('.dd-menu.open').forEach(m => {
        m.classList.remove('open');
        const btn = m.previousElementSibling as HTMLElement;
        if (btn) btn.setAttribute('aria-expanded', 'false');
      });
    });

    // Header scroll
    const header = document.querySelector('.site-header') as HTMLElement;
    window.addEventListener('scroll', () => {
      if (window.scrollY > 20) {
        header?.classList.add('scrolled');
      } else {
        header?.classList.remove('scrolled');
      }
    }, { passive: true });
  </script>
</body>
</html>
